(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{458:function(s,n,a){"use strict";a.r(n);var e=a(12),r=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、前言"}},[s._v("#")]),s._v(" 一、前言")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("Docker Compose和Dockerfile的区别")]),s._v("：\nDockerfile主要是记录了一个镜像的构建过程，可以达到快速构建项目的目的，而Docker Compose则是构建项目（服务）的过程，一个服务中可以有多个容器。docker-compose.yml不提供镜像的构建信息，而是通过Dockerfile进行获取（需要build的情况）。")])]),s._v(" "),n("p"),s._v(" "),n("h2",{attrs:{id:"二、docker-compose的安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、docker-compose的安装"}},[s._v("#")]),s._v(" 二、Docker Compose的安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 下载安装\ncurl -L https://get.daocloud.io/docker/compose/releases/download/1.20.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n\n# 添加权限\nchmod +x /usr/local/bin/docker-compose\n\n#查看版本\ndocker-compose version\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p"),s._v(" "),n("h2",{attrs:{id:"三、搭建项目环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、搭建项目环境"}},[s._v("#")]),s._v(" 三、搭建项目环境")]),s._v(" "),n("p",[n("strong",[s._v("3.1、项目目录结构")])]),s._v(" "),n("ul",[n("li",[s._v("docker目录下每个文件夹对应一个服务，并且有各自的"),n("code",[s._v("Dockerfile")]),s._v("（用于该服务的镜像构建）及相关挂载的数据，"),n("code",[s._v("docker-compose.yml")]),s._v("则控制各个服务的镜像构建，数据挂载，命令启动及启动流程等，通过"),n("code",[s._v("docker-compose")]),s._v("命令实现快速部署启动。")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontents.com/PI-KA-CHU/Image-OSS/main/images63484649-f3903000-c4d2-11e9-8118-65588e3ab32a.png",alt:"image"}})]),s._v(" "),n("p",[n("strong",[s._v("3.2、镜像文件详情")])]),s._v(" "),n("p",[n("strong",[s._v("a、Dockerfile:")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("app:\nFROM maven:3.5-jdk-8\n\nmysql：\nFROM mysql/mysql-server:5.7\n\nredis：\nFROM redis:5.0.5\n\nrocketmq：未整合\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("b、docker-compose.yml：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\nservices:\n  nginx:\n    container_name: bigdata-nginx\n    image: nginx:1.16.1\n    restart: always\n    ports:\n      - 80:80\n      - 443:443\n    volumes:\n      - ./nginx/conf.d:/etc/nginx/conf.d\n      - /tmp/logs/nginx:/var/log/nginx\n\n  mysql:\n    container_name: bigdata-mysql\n    build: mysql\n    # command: --default-authentication-plugin=mysql_native_password\n    environment:\n      MYSQL_DATABASE: multisource_bigdata\n      MYSQL_ROOT_PASSWORD: root\n      MYSQL_ROOT_HOST: '%'\n      MYSQL_USER: 'hive'\n      MYSQL_PASS: 'hive'\n      TZ: Asia/Shanghai\n    ports:\n      - 3306:3306\n    volumes:\n      - ./mysql/mysql_data:/var/lib/mysql\n    restart: always\n\n  redis:\n    container_name: bigdata-redis\n    build: redis\n    working_dir: /redis\n    volumes:\n      - ./redis/redis.conf:/etc/redis/redis.conf\n    restart: always\n    ports:\n      - 6379:6379\n    command: redis-server /etc/redis/redis.conf\n\n  app:\n    container_name: bigdata-app\n    build: app\n    volumes:\n      - ././:/app\n      - ~/.m2:/root/.m2\n      - /tmp/logs/app:/usr/local/logs\n    working_dir: /app\n    restart: always\n    expose:\n      - 8080\n    command: mvn clean spring-boot:run -Pprod -Dmaven.test.skip=true\n    depends_on:\n      - nginx\n      - mysql\n      - redis\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br")])]),n("p",[n("strong",[s._v("c、/nginx/conf.d/app.conf")]),s._v("：nginx的挂载文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen 80;\n    charset utf-8;\n    access_log off;\n\n    location / {\n        proxy_pass http://app:8080;\n        proxy_set_header Host $host:$server_port;\n        proxy_set_header X-Forwarded-Host $server_name;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    location /static {\n        access_log   off;\n        expires      30d;\n\n        alias /app/static;\n    }\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("strong",[s._v("d、/mysql/mysql_data")]),s._v("：mysql数据库数据的挂载")]),s._v(" "),n("p",[n("strong",[s._v("e、/redis/redis.conf")]),s._v("：redis配置文件的挂载")]),s._v(" "),n("ul",[n("li",[s._v("比如我们先在本地配置redis，并成功整合项目后，可以将原来的配置文件挂载到容器的redis配置文件下，从而快速实现整合")])]),s._v(" "),n("p"),s._v(" "),n("h2",{attrs:{id:"四、快速部署并启动项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、快速部署并启动项目"}},[s._v("#")]),s._v(" 四、快速部署并启动项目")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1、cd 进入项目 /src/docker 目录\n2、执行 `docker-compose up` (会出现相关的启动图标。如redis、springboot等)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://raw.githubusercontents.com/PI-KA-CHU/Image-OSS/main/images63485632-b4fc7480-c4d6-11e9-8d18-696d767f4f6f.png",alt:"image"}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n3、访问项目的index界面，测试nginx：\n    - http://192.168.125.131/index.html\n    - （resource/static/index.html）\n4、访问接口，测试数据库连接及redis缓存（接口实现缓存的情况）\n    - http://192.168.125.131/api/test/getUser\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://raw.githubusercontents.com/PI-KA-CHU/Image-OSS/main/images63485717-191f3880-c4d7-11e9-91ec-ab4ad1aa54d2.png",alt:"image"}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("5、容器内部访问（非必须）\n\n# 查看容器Id\ndocker ps -a\n# 进入容器内部\ndocker exec -it 容器Id bash\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p"),s._v(" "),n("h2",{attrs:{id:"五、问题与解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、问题与解决"}},[s._v("#")]),s._v(" 五、问题与解决：")]),s._v(" "),n("p",[n("strong",[s._v("问题一")]),s._v("：执行"),n("code",[s._v("docker-compose up")]),s._v("后异常")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('container_linux.go:345: starting container process caused "exec: \\"mvn\\": executable file not found in $PATH": unknown\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("解决")]),s._v("："),n("a",{attrs:{href:"https://medium.com/p/baf30968163e/responses/show",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("构建的docker容器中没有maven环境，无法通过maven进行打包，将web项目的镜像改为 maven:3.5-jdk-8 ，此镜像包含了jdk1.8 + maven3.5，即可正常运行\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p"),s._v(" "),n("p",[n("strong",[s._v("问题二")]),s._v("：修改mysql密码不生效问题")]),s._v(" "),n("p",[n("strong",[s._v("解决")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("重启mysql的docker服务\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("问题三")]),s._v("：navicat无法正常连接docker数据库")]),s._v(" "),n("p",[n("strong",[s._v("解决")]),s._v("：")]),s._v(" "),n("ul",[n("li",[s._v("本人问题：mysql的映射端口弄错了，搞了半天，坑爹啊")]),s._v(" "),n("li",[s._v("其他参考："),n("a",{attrs:{href:"https://blog.csdn.net/liqz666/article/details/82225575",target:"_blank",rel:"noopener noreferrer"}},[s._v("链接"),n("OutboundLink")],1)])]),s._v(" "),n("p",[n("strong",[s._v("问题四")]),s._v("：无法正常连接服务，如redis、mysql等")]),s._v(" "),n("p",[n("strong",[s._v("解决")]),s._v("："),n("a",{attrs:{href:"https://blog.csdn.net/harris135/article/details/74167910",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),n("OutboundLink")],1)]),s._v(" "),n("ul",[n("li",[s._v("方案一：将相关端口添加到防火墙开放：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 添加开放端口\nfirewall-cmd --zone=public --add-port=80/tcp --permanent  \n\n# 重启防火墙（不重启可能无法生效）\nsystemctl restart firewalld.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("方案二：关闭防火墙："),n("code",[s._v("systemctl stop firewalld.service")])])]),s._v(" "),n("p"),s._v(" "),n("h2",{attrs:{id:"六、参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、参考"}},[s._v("#")]),s._v(" 六、参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.ityouknow.com/docker/2018/03/22/docker-compose.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考一"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/efd70ad53602",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考二"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://www.ityouknow.com/springboot/2018/04/02/docker-favorites.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考三"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://www.ityouknow.com/springboot/2018/03/28/dockercompose-springboot-mysql-nginx.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考四"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=r.exports}}]);