(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{367:function(s,n,e){"use strict";e.r(n);var a=e(12),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、redis单机版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、redis单机版"}},[s._v("#")]),s._v(" 一、redis单机版")]),s._v(" "),n("h4",{attrs:{id:"写在前面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#写在前面"}},[s._v("#")]),s._v(" 写在前面")]),s._v(" "),n("ul",[n("li",[s._v("选中代码块，按"),n("code",[s._v("control + alt + t")]),s._v("：快捷"),n("strong",[s._v("tryCatch")])]),s._v(" "),n("li",[s._v("选中类名，按"),n("code",[s._v("control + shift + t")]),s._v("：快捷创建"),n("strong",[s._v("Junit Test")])])]),s._v(" "),n("h4",{attrs:{id:"redis连接的准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis连接的准备工作"}},[s._v("#")]),s._v(" redis连接的准备工作")]),s._v(" "),n("ul",[n("li",[s._v("如果是阿里云购买的服务器的话，需要"),n("strong",[s._v("开放redis的启动端口")]),s._v("，默认端口为6379")]),s._v(" "),n("li",[s._v("打开redis根目录下的redis.conf文件，将"),n("code",[s._v("bind 127.0.0.1")]),s._v("注释掉，即改为"),n("code",[s._v("# bind 127.0.0.1")]),s._v("，否则只能进行本地连接，从而报异常")]),s._v(" "),n("li",[s._v("找到redis.conf文件中的"),n("code",[s._v("protected-mode yes")]),s._v("，将其改为"),n("code",[s._v("protected-mode no")]),s._v("，关闭保护模式，否则会报连接被终止的异常")]),s._v(" "),n("li",[s._v("重启redis，重启的使用应携带conf文件进行重启，在redis的src文件下执行"),n("code",[s._v("./redis-server ../redis.conf")]),s._v("重启redis，直接重启配置文件并不会生效")])]),s._v(" "),n("h4",{attrs:{id:"redis相关配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis相关配置"}},[s._v("#")]),s._v(" redis相关配置")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("依赖包引入")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\x3c!-- 引入redis依赖 --\x3e\n<dependency>\n\t<groupId>org.springframework.boot</groupId>\n\t<artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n\n\x3c!-- redis依赖commons-pool 这个依赖一定要添加 --\x3e\n<dependency>\n\t<groupId>org.apache.commons</groupId>\n\t<artifactId>commons-pool2</artifactId>\n</dependency>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("配置springBoot的配置文件（application.properties或application.yml），此处配置的是"),n("strong",[s._v("application.properties")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# redis相关配置\n# redis数据库索引\nspring.redis.database=0\n# redis服务器地址\nspring.redis.host=120.78.151.65\n# redis服务器连接端口\nspring.redis.port=6379\n# redis服务器连接密码\nspring.redis.password=\n# 连接池最大连接数（负值表示没有限制）\nspring.redis.lettuce.pool.max-active=8\n# 连接池最大阻塞等待时间（负值表示无限制）\nspring.redis.jedis.pool.max-wait=-1\n# 连接池中的最大空闲连接\nspring.redis.lettuce.pool.max-idle=8\n# 连接池中的最小空闲连接\nspring.redis.lettuce.pool.min-idle=0\n# 连接超时时间（毫秒）\nspring.redis.timeout=5000\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("创建"),n("code",[s._v("RedisConfig.java")]),s._v("文件，配置自定义"),n("strong",[s._v("redisTemplate")]),s._v("，解决因默认序列化"),n("code",[s._v("JdkSerializationRedisSerializer")]),s._v("导致的字符显示不正常的问题。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import com.fasterxml.jackson.annotation.JsonAutoDetect;\nimport com.fasterxml.jackson.annotation.PropertyAccessor;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.springframework.boot.autoconfigure.AutoConfigureAfter;\nimport org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n@Configuration\n@AutoConfigureAfter(RedisAutoConfiguration.class)\npublic class RedisConfig {\n\n    /**\n     * 配置自定义redisTemplate\n     * @return\n     */\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {\n\n        RedisTemplate<String, Object> template = new RedisTemplate<>();\n        template.setConnectionFactory(redisConnectionFactory);\n\n        //使用Jackson2JsonRedisSerializer来序列化和反序列化redis的value值\n        Jackson2JsonRedisSerializer serializer = new Jackson2JsonRedisSerializer(Object.class);\n\n        ObjectMapper mapper = new ObjectMapper();\n        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);\n        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);\n        serializer.setObjectMapper(mapper);\n\n        template.setValueSerializer(serializer);\n        //使用StringRedisSerializer来序列化和反序列化redis的key值\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setHashKeySerializer(new StringRedisSerializer());\n        template.setHashValueSerializer(serializer);\n        template.afterPropertiesSet();\n        return template;\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("ul",[n("li",[s._v("创建"),n("strong",[s._v("Junit测试")]),s._v("实例进行Junit测试,Idea编译器中选中类名，"),n("code",[s._v("control + shift + t")]),s._v("快捷创建")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('import org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.test.context.junit4.SpringRunner;\n\nimport java.util.concurrent.TimeUnit;\n\n@RunWith(SpringRunner.class)\n@SpringBootTest\npublic class RedisConfigTest {\n\n    private Logger log = LoggerFactory.getLogger(this.getClass());\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @Test\n    public void redisTemplate() {\n\n        // redis存储的键名\n        String key = "number";\n\n        //如果不存在则设置值，存在的话则不设置\n        redisTemplate.opsForValue().setIfAbsent(key, 1);\n\n        //设置哈希值map值\n        redisTemplate.opsForHash().put("map", "place", "北京");\n        //获取到哈希值\n        String place = (String) redisTemplate.opsForHash().get("map","place");\n        log.info("[获取到的哈希值] - {}",place);\n\n        //进行值的增加和减少（需要为Integer）\n        redisTemplate.opsForValue().increment("number",-10);\n        \n        //log中的“{}”为占位符\n        String value = (String) redisTemplate.opsForValue().get("school");\n        log.info("[redis中 获取到的值] - [{}]",value);\n\n        //设置有效时间为10秒的键值\n        redisTemplate.opsForValue().set("flag","10",10, TimeUnit.SECONDS);\n        String flag = (String) redisTemplate.opsForValue().get("flag");\n        log.info("[获取到的有效时间为10秒的flag] - [{}]",flag);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("p"),s._v(" "),n("h4",{attrs:{id:"redis整合遇到的坑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis整合遇到的坑"}},[s._v("#")]),s._v(" Redis整合遇到的坑")]),s._v(" "),n("p",[n("strong",[s._v("问题一：")])]),s._v(" "),n("ul",[n("li",[s._v("SpringBoot整合Redis后连接Redsi出现"),n("strong",[s._v("超时")]),s._v("问题")])]),s._v(" "),n("p",[n("strong",[s._v("解决：")])]),s._v(" "),n("ul",[n("li",[s._v("网上的redis的相关配置中都是"),n("code",[s._v("spring.redis.timeout=0")]),s._v("，超时时间不能设置为0，可以设置为5000（根据实际情况设置）。")])]),s._v(" "),n("p",[n("strong",[s._v("问题二：")])]),s._v(" "),n("ul",[n("li",[s._v("修改redis的conf文件后重启redis配置没有生效，一直报连接被主机中的软件中止。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("org.springframework.data.redis.RedisSystemException: Redis exception; nested exception is io.lettuce.core.RedisException: java.io.IOException: 你的主机中的软件中止了一个已建立的连接。\n...\nCaused by: java.io.IOException: 你的主机中的软件中止了一个已建立的连接。\n\tat sun.nio.ch.SocketDispatcher.read0(Native Method)\n\tat sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:43)\n\tat sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:223)\n\tat sun.nio.ch.IOUtil.read(IOUtil.java:192)\n\tat sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:380)\n\tat io.netty.buffer.PooledUnsafeDirectByteBuf.setBytes(PooledUnsafeDirectByteBuf.java:288)\n\tat io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1108)\n\tat io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:345)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:748)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[n("strong",[s._v("解决：")])]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/Agly_Clarlie/article/details/52251746",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考一"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("在启动redis的时候，连同配置文件一起启动"),n("code",[s._v("./redis-server redis.conf")])])]),s._v(" "),n("p"),s._v(" "),n("p")])}),[],!1,null,null,null);n.default=t.exports}}]);